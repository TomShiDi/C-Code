Microsoft (R) Macro Assembler Version 5.00                  11/20/5                                                             Page     1-1


				;利用FCB顺序读磁盘文件 
				； 
source\p510.ASM(2): warning A4001: Extra characters on line
 0000				stack   segment para stack 'stack' 
 0000  0050[			        dw 80 dup(?) 
	   ????			
			 ]	
				
 00A0				stack   ends 
				;----------------------------------------------
				-------- 
 0000				dseg    segment para 'data' 
 0000				fcbrec  label byte	;FCB 
 0000  00			fcbdriv db 0 
 0001  4E 41 4D 45 46 49 4C	febname db 'NAMEFILE' 
       45			
 0009  44 41 54			fcbext  db 'DAT' 
 000C  0000			fcbblk  dw 0 
 000E  ????			fcbrcsz dw ? 
 0010  ????????			fcbflsz dd ? 
 0014  ????			        dw ? 
 0016  ???????????????????	        dt ? 
       ?			
 0020  00			fcbsqrc db 0 
 0021  ????????			        dd ? 
				; 
 = 0020				reclen  equ 32 
 0025  0020[			namefld db reclen dup(' '), 13,10,'$'	;DTA 
	   20			
			 ]	
       0D 0A 24			
 0048  00			endcde  db 0 
 0049  00			row     db 0 
 004A  2A 2A 2A 2A 20 6F 70	opnmsg  db '**** open error ****$' 
       65 6E 20 65 72 72 6F	
       72 20 2A 2A 2A 2A 24	
 005F  2A 2A 2A 2A 20 77 72	redmsg  db '**** write error ****$' 
       69 74 65 20 65 72 72	
       6F 72 20 2A 2A 2A 2A	
       24			
 0075  70 72 65 73 73 20 61	press   db 'press anykey continue......$' 
       6E 79 6B 65 79 20 63	
       6F 6E 74 69 6E 75 65	
       2E 2E 2E 2E 2E 2E 24	
 0091				dseg    ends 
				 
				;------------------------------------ 
 0000				cseg    segment para 'code' 
				        assume cs:cseg,ds:dseg,ss:stack,es:dseg
				 
 0000  B8 ---- R		begin:   mov ax,dseg 
 0003  8E D8			        mov ds,ax 
 0005  8E C0			        mov es,ax 
 0007  B4 06			        mov ah,6 
Microsoft (R) Macro Assembler Version 5.00                  11/20/5                                                             Page     1-2


 0009  B0 00			        mov al,0 
 000B  E8 00B1 R		        call scro	;清屏 
 000E  E8 00BC R		        call curs	;设置光标 
 0011  E8 002E R		        call openf	;打开文件 
 0014  80 3E 0048 R 00		        cmp endcde,0	; 
 0019  75 0F			        jnz exit 
 001B  E8 0056 R		loop1:  call readf	;读文件记录到DTA 
 001E  80 3E 0048 R 00		        cmp endcde,0 
 0023  75 05			        jnz exit 
 0025  E8 0082 R		        call disp	;显示读出记录 
 0028  EB F1			        jmp loop1 
				; 
 002A  B4 4C			exit:   mov ah,4ch 
 002C  CD 21			        int 21h 
				 
				;--------------------------------- 
				;打开文件，设置记录大小为32，初始化DTA 
				; 
 002E				openf   proc 
 002E  B4 0F			        mov ah,0fh 
 0030  8D 16 0000 R		        lea dx,fcbrec 
 0034  CD 21			        int 21h 
 0036  3C 00			        cmp al,0 
 0038  75 0F			        jnz error 
 003A  C7 06 000E R 0020	        mov fcbrcsz,reclen 
 0040  8D 16 0025 R		        lea dx,namefld 
 0044  B4 1A			        mov ah,1ah 
 0046  CD 21			        int 21h 
 0048  C3			        ret 
 0049  C6 06 0048 R 01		error:  mov endcde,1 
 004E  8D 16 004A R		        lea dx,opnmsg 
 0052  E8 00C9 R		        call errm 
 0055  C3			        ret 
 0056				openf   endp 
				;---------------------------------------       
				  
				;顺序读磁盘记录，且使FCB当前记录号递增。 
				; 
 0056				readf   proc 
 0056  B4 14			        mov ah,14h 
 0058  8D 16 0000 R		        lea dx,fcbrec 
 005C  CD 21			        int 21h 
 005E  80 3E 0025 R 1A		        cmp namefld,1ah 
 0063  75 08			        jne tests 
 0065  C6 06 0048 R 01		        mov endcde,1 
 006A  EB 15 90			        jmp rend 
 006D  3C 00			tests:  cmp al,0 
 006F  74 10			        jz rend 
 0071  C6 06 0048 R 01		        mov endcde,1 
 0076  3C 01			        cmp al,1 
 0078  74 07			        jz rend 
 007A  8D 16 005F R		        lea dx,redmsg 
 007E  E8 00C9 R		        call errm 
 0081  C3			rend:   ret 
Microsoft (R) Macro Assembler Version 5.00                  11/20/5                                                             Page     1-3


 0082				readf   endp 
				 
				;------------------------------------- 
				;显示读出信息 
				; 
 0082				disp    proc 
 0082  B4 09			        mov ah,9 
 0084  8D 16 0025 R		        lea dx,namefld 
 0088  CD 21			        int 21h 
 008A  80 3E 0049 R 17		        cmp row,17h 
 008F  73 05			        jae pass 
 0091  FE 06 0049 R		        inc row 
 0095  C3			        ret 
 0096  8D 16 0075 R		pass:   lea dx,press 
 009A  B4 09			        mov ah,9 
 009C  CD 21			        int 21h 
 009E  B4 07			        mov ah,7 
 00A0  CD 21			        int 21h 
 00A2  C6 06 0049 R 00		        mov row,0 
 00A7  B8 0600			        mov ax,0600h 
 00AA  E8 00B1 R		        call  scro 
 00AD  E8 00BC R		        call curs 
 00B0  C3			        ret 
 00B1				disp    endp 
				;--------------------------------- 
 00B1				scro    proc 
 00B1  B7 1E			        mov bh,1eh 
 00B3  B9 0000			        mov cx,0 
 00B6  BA 184F			        mov dx,184fh 
 00B9  CD 10			        int 10h 
 00BB  C3			        ret 
 00BC				scro    endp 
				;----------------------------------------------
				---- 
 00BC				curs    proc 
 00BC  B4 02			        mov ah,2 
 00BE  B7 00			        mov bh,0 
 00C0  B2 00			        mov dl,0 
 00C2  8A 36 0049 R		        mov dh,row 
 00C6  CD 10			        int 10h 
 00C8  C3			        ret 
 00C9				curs    endp 
				;----------------------------------------------
				---- 
 00C9				errm    proc 
 00C9  B4 09			        mov ah,9 
 00CB  CD 21			        int 21h 
 00CD  C6 06 0048 R 01		        mov endcde,1 
 00D2  C3			        ret 
 00D3				errm    endp 
				;----------------------------------------------
				------ 
 00D3				cseg    ends 
				        end begin 
Microsoft (R) Macro Assembler Version 5.00                  11/20/5                                                             Symbols-1


Segments and Groups:

                N a m e         	Length	 Align	Combine Class

CSEG . . . . . . . . . . . . . .  	00D3	PARA	NONE	'CODE'
DSEG . . . . . . . . . . . . . .  	0091	PARA	NONE	'DATA'
STACK  . . . . . . . . . . . . .  	00A0	PARA	STACK	'STACK'

Symbols:            

                N a m e         	Type	 Value	 Attr

BEGIN  . . . . . . . . . . . . .  	L NEAR	0000	CSEG

CURS . . . . . . . . . . . . . .  	N PROC	00BC	CSEG	Length = 000D

DISP . . . . . . . . . . . . . .  	N PROC	0082	CSEG	Length = 002F

ENDCDE . . . . . . . . . . . . .  	L BYTE	0048	DSEG
ERRM . . . . . . . . . . . . . .  	N PROC	00C9	CSEG	Length = 000A
ERROR  . . . . . . . . . . . . .  	L NEAR	0049	CSEG
EXIT . . . . . . . . . . . . . .  	L NEAR	002A	CSEG

FCBBLK . . . . . . . . . . . . .  	L WORD	000C	DSEG
FCBDRIV  . . . . . . . . . . . .  	L BYTE	0000	DSEG
FCBEXT . . . . . . . . . . . . .  	L BYTE	0009	DSEG
FCBFLSZ  . . . . . . . . . . . .  	L DWORD	0010	DSEG
FCBRCSZ  . . . . . . . . . . . .  	L WORD	000E	DSEG
FCBREC . . . . . . . . . . . . .  	L BYTE	0000	DSEG
FCBSQRC  . . . . . . . . . . . .  	L BYTE	0020	DSEG
FEBNAME  . . . . . . . . . . . .  	L BYTE	0001	DSEG

LOOP1  . . . . . . . . . . . . .  	L NEAR	001B	CSEG

NAMEFLD  . . . . . . . . . . . .  	L BYTE	0025	DSEG	Length = 0020

OPENF  . . . . . . . . . . . . .  	N PROC	002E	CSEG	Length = 0028
OPNMSG . . . . . . . . . . . . .  	L BYTE	004A	DSEG

PASS . . . . . . . . . . . . . .  	L NEAR	0096	CSEG
PRESS  . . . . . . . . . . . . .  	L BYTE	0075	DSEG

READF  . . . . . . . . . . . . .  	N PROC	0056	CSEG	Length = 002C
RECLEN . . . . . . . . . . . . .  	NUMBER	0020	
REDMSG . . . . . . . . . . . . .  	L BYTE	005F	DSEG
REND . . . . . . . . . . . . . .  	L NEAR	0081	CSEG
ROW  . . . . . . . . . . . . . .  	L BYTE	0049	DSEG

SCRO . . . . . . . . . . . . . .  	N PROC	00B1	CSEG	Length = 000B

TESTS  . . . . . . . . . . . . .  	L NEAR	006D	CSEG

@FILENAME  . . . . . . . . . . .  	TEXT  p510		

Microsoft (R) Macro Assembler Version 5.00                  11/20/5                                                             Symbols-2



    139 Source  Lines
    139 Total   Lines
     35 Symbols

  50292 + 450668 Bytes symbol space free

      1 Warning Errors
      0 Severe  Errors
